<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://opensciencegrid.org/user-school-2019/materials/day1/part1-ex7-compile/">
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Bonus Exercise 1.7 - OSG User School 2019</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <link href="../../../css/extra.css" rel="stylesheet">
    <link href="../../../css/codehilite.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Monday Bonus Exercise 1.7: Compile and Run Some C Code", url: "#_top", children: [
              {title: "Preparing a C Executable", url: "#preparing-a-c-executable" },
              {title: "Running a Compiled C Program", url: "#running-a-compiled-c-program" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    <style type="text/css"> pre em { font-style: normal; background-color: yellow; } pre strong { font-style: normal; font-weight: bold; color: \#008; } </style>

<h1 id="monday-bonus-exercise-17-compile-and-run-some-c-code">Monday Bonus Exercise 1.7: Compile and Run Some C Code<a class="headerlink" href="#monday-bonus-exercise-17-compile-and-run-some-c-code" title="Permanent link">&para;</a></h1>
<p>The goal of this exercise is to show that compiled code works just fine in HTCondor. It is mainly of interest to people who have their own C code to run (or C++, or really any compiled code, although Java would be handled a bit differently).</p>
<h2 id="preparing-a-c-executable">Preparing a C Executable<a class="headerlink" href="#preparing-a-c-executable" title="Permanent link">&para;</a></h2>
<p>When preparing a C program for HTCondor, it is best to compile and link the executable statically, so that it does not depend on external libraries and their particular versions. Why is this important? When your compiled C program is sent to another machine for execution, that machine may not have the same libraries that you have on your submit machine (or wherever you compile the program). If the libraries are not available or are the wrong versions, your program may fail or, perhaps worse, silently produce the wrong results.</p>
<p>Here is a simple C program to try using (thanks, Alain Roy):</p>
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">sleep_time</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">input</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">failure</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Usage: simple &lt;sleep-time&gt; &lt;integer&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="n">failure</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">sleep_time</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="n">input</span>      <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>

        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Thinking really hard for %d seconds...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">sleep_time</span><span class="p">);</span>
        <span class="n">sleep</span><span class="p">(</span><span class="n">sleep_time</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;We calculated: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">input</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
        <span class="n">failure</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">failure</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>Save that code to a file, for example, <code>simple.c</code>.</p>
<p>Compile the program with static linking:</p>
<div class="codehilite"><pre><span></span><span class="gp">username@learn $</span> gcc -static -o simple simple.c
</pre></div>


<p>As always, test that you can run your command from the command line first. First, without arguments to make sure it fails correctly:</p>
<div class="codehilite"><pre><span></span><span class="gp">username@learn $</span> ./simple
</pre></div>


<p>and then with valid arguments:</p>
<div class="codehilite"><pre><span></span><span class="gp">username@learn $</span> ./simple <span class="m">5</span> <span class="m">21</span>
</pre></div>


<h2 id="running-a-compiled-c-program">Running a Compiled C Program<a class="headerlink" href="#running-a-compiled-c-program" title="Permanent link">&para;</a></h2>
<p>The rest is simple. In fact, it is no different than running any other program. Here is a basic submit file for the C program (call it simple.sub):</p>
<div class="codehilite"><pre><span></span>executable = simple
arguments = &quot;60 64&quot;

output = c-program.out
error = c-program.err
log = c-program.log

should_transfer_files = YES
when_to_transfer_output = ON_EXIT

queue
</pre></div>


<p>Then submit the job as usual!</p>
<p>In summary, it is easy to work with statically linked compiled code. It <strong>is</strong> possible to handle dynamically linked compiled code, but it is trickier. We will only mention this topic briefly on Wednesday.</p>

  <br>
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../part2-ex1-files/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../part2-ex1-files/" class="btn btn-xs btn-link">
        Exercise 2.1
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../part1-ex6-remove/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../part1-ex6-remove/" class="btn btn-xs btn-link">
        Exercise 1.6
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>